var S={KEY_INPUT:1,MOUSE_INPUT:2,MOUSE_MOVE:3,MOUSE_SCROLL:4,TEXT_INPUT:5,RESIZE:16,REQUEST_KEYFRAME:17,PAUSE_STREAM:18,RESUME_STREAM:19,CONNECT_PANEL:32,CREATE_PANEL:33},$={KEYFRAME:1,DELTA:2},X={FILE_UPLOAD:16,FILE_DOWNLOAD:17,FOLDER_DOWNLOAD:20,CLOSE_PANEL:129,RESIZE_PANEL:130,FOCUS_PANEL:131,SPLIT_PANEL:132,CLOSE_TAB:133,SWITCH_TAB:134,NEW_TAB:135,RENAME_TAB:136,GET_AUTH_STATE:144,SET_PASSWORD:145,VERIFY_PASSWORD:146,CLEAR_PASSWORD:147,CREATE_SESSION:148,DELETE_SESSION:149,REGEN_TOKEN:150,CREATE_SHARE_LINK:151,REVOKE_SHARE_LINK:152,GET_SESSION_LIST:153,GET_SHARE_LINKS:154},Z={FILE_DATA:18,FILE_ERROR:19,FOLDER_DATA:21},J={AUTH_STATE:10,SESSION_LIST:11,SHARE_LINKS:12},W={TRANSFER_INIT:32,FILE_LIST_REQUEST:33,FILE_DATA:34,TRANSFER_RESUME:35,TRANSFER_CANCEL:36,TRANSFER_READY:48,FILE_LIST:49,FILE_REQUEST:50,FILE_ACK:51,TRANSFER_COMPLETE:52,TRANSFER_ERROR:53,DRY_RUN_REPORT:54},G={ADMIN:0,EDITOR:1,VIEWER:2,NONE:255},T={KeyA:0,KeyS:1,KeyD:2,KeyF:3,KeyH:4,KeyG:5,KeyZ:6,KeyX:7,KeyC:8,KeyV:9,IntlBackslash:10,KeyB:11,KeyQ:12,KeyW:13,KeyE:14,KeyR:15,KeyY:16,KeyT:17,Digit1:18,Digit2:19,Digit3:20,Digit4:21,Digit6:22,Digit5:23,Equal:24,Digit9:25,Digit7:26,Minus:27,Digit8:28,Digit0:29,BracketRight:30,KeyO:31,KeyU:32,BracketLeft:33,KeyI:34,KeyP:35,Enter:36,KeyL:37,KeyJ:38,Quote:39,KeyK:40,Semicolon:41,Backslash:42,Comma:43,Slash:44,KeyN:45,KeyM:46,Period:47,Tab:48,Space:49,Backquote:50,Backspace:51,Escape:53,MetaRight:54,MetaLeft:55,ShiftLeft:56,CapsLock:57,AltLeft:58,ControlLeft:59,ShiftRight:60,AltRight:61,ControlRight:62,F17:64,NumpadDecimal:65,NumpadMultiply:67,NumpadAdd:69,NumLock:71,NumpadDivide:75,NumpadEnter:76,NumpadSubtract:78,F18:79,F19:80,NumpadEqual:81,Numpad0:82,Numpad1:83,Numpad2:84,Numpad3:85,Numpad4:86,Numpad5:87,Numpad6:88,Numpad7:89,F20:90,Numpad8:91,Numpad9:92,IntlYen:93,IntlRo:94,F5:96,F6:97,F7:98,F3:99,F8:100,F9:101,F11:103,F13:105,F16:106,F14:107,F10:109,F12:111,F15:113,Home:115,PageUp:116,Delete:117,F4:118,End:119,F2:120,PageDown:121,F1:122,ArrowLeft:123,ArrowRight:124,ArrowDown:125,ArrowUp:126};var V=`
  @group(0) @binding(0) var<storage, read> diff: array<u32>;
  @group(0) @binding(1) var<storage, read_write> prev: array<u32>;

  @compute @workgroup_size(256)
  fn main(@builtin(global_invocation_id) id: vec3<u32>) {
    let idx = id.x;
    if (idx < arrayLength(&prev)) {
      prev[idx] = prev[idx] ^ diff[idx];
    }
  }
`,P=`
  @group(0) @binding(0) var<storage, read> rgb: array<u32>;
  @group(0) @binding(1) var outTex: texture_storage_2d<rgba8unorm, write>;

  @compute @workgroup_size(16, 16)
  fn main(@builtin(global_invocation_id) id: vec3<u32>) {
    let dims = textureDimensions(outTex);
    if (id.x >= dims.x || id.y >= dims.y) { return; }

    let pixelIdx = id.y * dims.x + id.x;
    let byteIdx = pixelIdx * 3u;
    let wordIdx = byteIdx / 4u;
    let byteOff = byteIdx % 4u;

    let w0 = rgb[wordIdx];
    let w1 = rgb[wordIdx + 1u];

    var r: u32; var g: u32; var b: u32;
    if (byteOff == 0u) {
      r = (w0 >> 0u) & 0xFFu;
      g = (w0 >> 8u) & 0xFFu;
      b = (w0 >> 16u) & 0xFFu;
    } else if (byteOff == 1u) {
      r = (w0 >> 8u) & 0xFFu;
      g = (w0 >> 16u) & 0xFFu;
      b = (w0 >> 24u) & 0xFFu;
    } else if (byteOff == 2u) {
      r = (w0 >> 16u) & 0xFFu;
      g = (w0 >> 24u) & 0xFFu;
      b = (w1 >> 0u) & 0xFFu;
    } else {
      r = (w0 >> 24u) & 0xFFu;
      g = (w1 >> 0u) & 0xFFu;
      b = (w1 >> 8u) & 0xFFu;
    }

    let color = vec4<f32>(f32(r) / 255.0, f32(g) / 255.0, f32(b) / 255.0, 1.0);
    textureStore(outTex, vec2<i32>(i32(id.x), i32(id.y)), color);
  }
`,j=`
  @group(0) @binding(0) var tex: texture_2d<f32>;
  @group(0) @binding(1) var samp: sampler;

  struct VSOut {
    @builtin(position) pos: vec4<f32>,
    @location(0) uv: vec2<f32>,
  };

  @vertex
  fn vs(@builtin(vertex_index) idx: u32) -> VSOut {
    var pos = array<vec2<f32>, 4>(
      vec2(-1.0, 1.0), vec2(1.0, 1.0), vec2(-1.0, -1.0), vec2(1.0, -1.0)
    );
    var uv = array<vec2<f32>, 4>(
      vec2(0.0, 0.0), vec2(1.0, 0.0), vec2(0.0, 1.0), vec2(1.0, 1.0)
    );
    var out: VSOut;
    out.pos = vec4(pos[idx], 0.0, 1.0);
    out.uv = uv[idx];
    return out;
  }

  @fragment
  fn fs(in: VSOut) -> @location(0) vec4<f32> {
    return textureSample(tex, samp, in.uv);
  }
`;class E{id;serverId;container;canvas;element;ws=null;width=0;height=0;pwd=null;sequence=0;lastReportedWidth=0;lastReportedHeight=0;resizeTimeout=null;resizeObserver=null;callbacks;device=null;context=null;pipeline=null;xorPipeline=null;rgbToRgbaPipeline=null;prevBuffer=null;diffBuffer=null;texture=null;sampler=null;xorBindGroup=null;convertBindGroup=null;renderBindGroup=null;inspectorEl;inspectorVisible=!1;inspectorHeight=200;inspectorActiveTab="screen";inspectorState=null;constructor(t,e,n=null,i={}){this.id=t,this.serverId=n,this.container=e,this.callbacks=i,this.canvas=document.createElement("canvas"),this.canvas.className="panel-canvas",this.canvas.tabIndex=0,this.element=document.createElement("div"),this.element.className="panel",this.element.appendChild(this.canvas),this.inspectorEl=this.createInspectorElement(),this.element.appendChild(this.inspectorEl),e.appendChild(this.element),this.setupInputHandlers(),this.initGPU(),this.setupResizeObserver()}createInspectorElement(){let t=document.createElement("div");return t.className="panel-inspector",t.innerHTML=`
      <div class="inspector-resize"></div>
      <div class="inspector-content">
        <div class="inspector-left">
          <div class="inspector-left-header">
            <div class="inspector-tabs">
              <button class="inspector-tab active" data-tab="screen">Screen</button>
            </div>
          </div>
          <div class="inspector-main"></div>
        </div>
        <div class="inspector-right">
          <div class="inspector-right-header">
            <span class="inspector-right-title">Surface Info</span>
          </div>
          <div class="inspector-sidebar"></div>
        </div>
      </div>
    `,this.setupInspectorHandlers(t),t}setupInspectorHandlers(t){let e=t.querySelectorAll(".inspector-tab");e.forEach((i)=>{i.addEventListener("click",()=>{e.forEach((s)=>s.classList.remove("active")),i.classList.add("active"),this.inspectorActiveTab=i.dataset.tab||"screen",this.sendInspectorTab(this.inspectorActiveTab),this.renderInspectorView()})});let n=t.querySelector(".inspector-resize");if(n){let i=0,s=0,r=(c)=>{let l=i-c.clientY,a=Math.min(Math.max(s+l,100),this.element.clientHeight*0.6);this.inspectorHeight=a,this.inspectorEl.style.height=`${a}px`},o=()=>{document.removeEventListener("mousemove",r),document.removeEventListener("mouseup",o),this.triggerResize()};n.addEventListener("mousedown",(c)=>{i=c.clientY,s=this.inspectorHeight,document.addEventListener("mousemove",r),document.addEventListener("mouseup",o)})}}toggleInspector(){this.inspectorVisible?this.hideInspector():this.showInspector()}showInspector(){this.inspectorVisible=!0,this.inspectorEl.classList.add("visible"),this.inspectorEl.style.height=`${this.inspectorHeight}px`,this.sendInspectorSubscribe(),this.triggerResize()}hideInspector(){this.inspectorVisible=!1,this.inspectorEl.classList.remove("visible"),this.sendInspectorUnsubscribe(),this.triggerResize()}sendInspectorSubscribe(){this.ws?.send(JSON.stringify({type:"inspector_subscribe",tab:this.inspectorActiveTab}))}sendInspectorUnsubscribe(){this.ws?.send(JSON.stringify({type:"inspector_unsubscribe"}))}sendInspectorTab(t){this.ws?.send(JSON.stringify({type:"inspector_tab",tab:t}))}handleInspectorState(t){this.inspectorState=t,this.renderInspectorSidebar(),this.renderInspectorView()}renderInspectorSidebar(){let t=this.inspectorEl.querySelector(".inspector-sidebar");if(!t||!this.inspectorState)return;let n=this.inspectorState.size||{};t.innerHTML=`
      <div class="inspector-simple-section">
        <span class="inspector-simple-title">Dimensions</span>
        <hr>
      </div>
      <div class="inspector-row">
        <span class="inspector-label">Screen Size</span>
        <span class="inspector-value">${n.screen_width??0}px x ${n.screen_height??0}px</span>
      </div>
      <div class="inspector-row">
        <span class="inspector-label">Grid Size</span>
        <span class="inspector-value">${n.cols??0}c x ${n.rows??0}r</span>
      </div>
      <div class="inspector-row">
        <span class="inspector-label">Cell Size</span>
        <span class="inspector-value">${n.cell_width??0}px x ${n.cell_height??0}px</span>
      </div>
    `}renderInspectorView(){let t=this.inspectorEl.querySelector(".inspector-main");if(!t)return;let n=this.inspectorState?.size||{};t.innerHTML=`
      <div class="inspector-simple-section">
        <span class="inspector-simple-title">Terminal Size</span>
        <hr>
      </div>
      <div class="inspector-row">
        <span class="inspector-label">Grid</span>
        <span class="inspector-value">${n.cols??0} columns × ${n.rows??0} rows</span>
      </div>
      <div class="inspector-row">
        <span class="inspector-label">Screen</span>
        <span class="inspector-value">${n.screen_width??0} × ${n.screen_height??0} px</span>
      </div>
    `}triggerResize(){requestAnimationFrame(()=>{let t=this.canvas.getBoundingClientRect(),e=Math.floor(t.width),n=Math.floor(t.height);if(e>0&&n>0&&this.serverId!==null&&this.callbacks.onResize)this.lastReportedWidth=e,this.lastReportedHeight=n,this.callbacks.onResize(this.serverId,e,n)})}setupResizeObserver(){this.resizeObserver=new ResizeObserver(()=>{if(this.resizeTimeout)clearTimeout(this.resizeTimeout);this.resizeTimeout=setTimeout(()=>{let t=this.container.getBoundingClientRect(),e=Math.floor(t.width),n=Math.floor(t.height);if(e===0||n===0)return;if(e===this.lastReportedWidth&&n===this.lastReportedHeight)return;if(this.lastReportedWidth=e,this.lastReportedHeight=n,this.serverId!==null&&this.callbacks.onResize)this.callbacks.onResize(this.serverId,e,n)},16)}),this.resizeObserver.observe(this.element)}async initGPU(){if(!navigator.gpu){console.error("WebGPU not supported");return}let t=await navigator.gpu.requestAdapter();if(!t){console.error("No WebGPU adapter");return}if(this.device=await t.requestDevice(),this.context=this.canvas.getContext("webgpu"),!this.context){console.error("Could not get WebGPU context");return}let e=navigator.gpu.getPreferredCanvasFormat();this.context.configure({device:this.device,format:e,alphaMode:"opaque"});let n=this.device.createShaderModule({code:V});this.xorPipeline=this.device.createComputePipeline({layout:"auto",compute:{module:n,entryPoint:"main"}});let i=this.device.createShaderModule({code:P});this.rgbToRgbaPipeline=this.device.createComputePipeline({layout:"auto",compute:{module:i,entryPoint:"main"}});let s=this.device.createShaderModule({code:j});this.pipeline=this.device.createRenderPipeline({layout:"auto",vertex:{module:s,entryPoint:"vs"},fragment:{module:s,entryPoint:"fs",targets:[{format:e}]},primitive:{topology:"triangle-strip"}}),this.sampler=this.device.createSampler({magFilter:"nearest",minFilter:"nearest"}),console.log("WebGPU initialized")}createGPUBuffers(t,e){if(!this.device)return;this.prevBuffer?.destroy(),this.diffBuffer?.destroy(),this.texture?.destroy();let n=t*e*3,i=Math.ceil(n/4)*4;this.prevBuffer=this.device.createBuffer({size:i,usage:GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_DST}),this.diffBuffer=this.device.createBuffer({size:i,usage:GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_DST}),this.texture=this.device.createTexture({size:[t,e],format:"rgba8unorm",usage:GPUTextureUsage.STORAGE_BINDING|GPUTextureUsage.TEXTURE_BINDING}),this.xorBindGroup=this.device.createBindGroup({layout:this.xorPipeline.getBindGroupLayout(0),entries:[{binding:0,resource:{buffer:this.diffBuffer}},{binding:1,resource:{buffer:this.prevBuffer}}]}),this.convertBindGroup=this.device.createBindGroup({layout:this.rgbToRgbaPipeline.getBindGroupLayout(0),entries:[{binding:0,resource:{buffer:this.prevBuffer}},{binding:1,resource:this.texture.createView()}]}),this.renderBindGroup=this.device.createBindGroup({layout:this.pipeline.getBindGroupLayout(0),entries:[{binding:0,resource:this.texture.createView()},{binding:1,resource:this.sampler}]})}connect(t,e){this.ws=new WebSocket(`ws://${t}:${e}`),this.ws.binaryType="arraybuffer",this.ws.onopen=()=>{if(console.log(`Panel ${this.id}: Connected`),this.serverId!==null)this.sendConnectPanel(this.serverId);else this.sendCreatePanel()},this.ws.onmessage=(n)=>{if(typeof n.data==="string")try{let i=JSON.parse(n.data);if(i.type==="inspector_state")this.handleInspectorState(i)}catch(i){console.error("Failed to parse JSON:",i)}else this.handleFrame(n.data)},this.ws.onclose=()=>{console.log(`Panel ${this.id}: Disconnected`)},this.ws.onerror=()=>{if(this.ws?.readyState===WebSocket.CLOSING||this.ws?.readyState===WebSocket.CLOSED)return;console.error(`Panel ${this.id}: WebSocket error`)}}disconnect(){this.ws?.close(),this.ws=null}sendConnectPanel(t){if(!this.ws||this.ws.readyState!==WebSocket.OPEN)return;let e=new ArrayBuffer(5),n=new DataView(e);n.setUint8(0,S.CONNECT_PANEL),n.setUint32(1,t,!0),this.ws.send(e)}sendCreatePanel(){if(!this.ws||this.ws.readyState!==WebSocket.OPEN)return;let t=this.container.getBoundingClientRect(),e=Math.floor(t.width)||800,n=Math.floor(t.height)||600,i=window.devicePixelRatio||1;this.lastReportedWidth=e,this.lastReportedHeight=n;let s=new ArrayBuffer(9),r=new DataView(s);r.setUint8(0,S.CREATE_PANEL),r.setUint16(1,e,!0),r.setUint16(3,n,!0),r.setFloat32(5,i,!0),this.ws.send(s)}async handleFrame(t){if(!this.device)return;let e=new DataView(t),n=e.getUint8(0),i=e.getUint32(1,!0),s=e.getUint16(5,!0),r=e.getUint16(7,!0),o=e.getUint32(9,!0);if(n===255){this.serverId=e.getUint32(1,!0),console.log(`Panel ${this.id} assigned server ID: ${this.serverId}`);return}if(s!==this.width||r!==this.height){this.width=s,this.height=r,this.canvas.width=s,this.canvas.height=r;let u=navigator.gpu.getPreferredCanvasFormat();this.context.configure({device:this.device,format:u,alphaMode:"opaque"}),this.createGPUBuffers(s,r)}let c=new Uint8Array(t,13,o),l;try{l=await this.decompress(c)}catch(u){console.error("Decompress failed:",u);return}let a=s*r*3;if(l.length!==a){console.error(`Size mismatch: got ${l.length}, expected ${a}`);return}let d=Math.ceil(l.length/4)*4,f=l;if(l.length!==d)f=new Uint8Array(d),f.set(l);if(n===$.KEYFRAME)this.device.queue.writeBuffer(this.prevBuffer,0,f);else{this.device.queue.writeBuffer(this.diffBuffer,0,f);let u=this.device.createCommandEncoder(),p=u.beginComputePass();p.setPipeline(this.xorPipeline),p.setBindGroup(0,this.xorBindGroup),p.dispatchWorkgroups(Math.ceil(l.length/4/256)),p.end(),this.device.queue.submit([u.finish()])}this.renderFrame(),this.sequence=i}async decompress(t){let e=new DecompressionStream("deflate-raw"),n=e.writable.getWriter();n.write(t),n.close();let i=e.readable.getReader(),s=[],r=0;while(!0){let{done:l,value:a}=await i.read();if(l)break;s.push(a),r+=a.length}let o=new Uint8Array(r),c=0;for(let l of s)o.set(l,c),c+=l.length;return o}renderFrame(){if(!this.device||!this.context||!this.pipeline)return;let t=this.device.createCommandEncoder(),e=t.beginComputePass();e.setPipeline(this.rgbToRgbaPipeline),e.setBindGroup(0,this.convertBindGroup),e.dispatchWorkgroups(Math.ceil(this.width/16),Math.ceil(this.height/16)),e.end();let n=t.beginRenderPass({colorAttachments:[{view:this.context.getCurrentTexture().createView(),loadOp:"clear",storeOp:"store",clearValue:{r:0,g:0,b:0,a:1}}]});n.setPipeline(this.pipeline),n.setBindGroup(0,this.renderBindGroup),n.draw(4),n.end(),this.device.queue.submit([t.finish()])}setupInputHandlers(){this.canvas.addEventListener("keydown",(t)=>{t.preventDefault();let e=T[t.code]??0,n=this.getModifiers(t);this.sendKeyInput(e,1,n,t.key.length===1?t.key:void 0)}),this.canvas.addEventListener("keyup",(t)=>{t.preventDefault();let e=T[t.code]??0,n=this.getModifiers(t);this.sendKeyInput(e,0,n)}),this.canvas.addEventListener("mousedown",(t)=>{this.canvas.focus();let e=this.canvas.getBoundingClientRect();this.sendMouseInput(t.clientX-e.left,t.clientY-e.top,t.button,1,this.getModifiers(t))}),this.canvas.addEventListener("mouseup",(t)=>{let e=this.canvas.getBoundingClientRect();this.sendMouseInput(t.clientX-e.left,t.clientY-e.top,t.button,0,this.getModifiers(t))}),this.canvas.addEventListener("mousemove",(t)=>{if(t.buttons===0)return;let e=this.canvas.getBoundingClientRect(),n=new ArrayBuffer(8),i=new DataView(n);i.setUint8(0,S.MOUSE_MOVE),i.setUint16(1,t.clientX-e.left,!0),i.setUint16(3,t.clientY-e.top,!0),i.setUint8(5,t.buttons),i.setUint8(6,this.getModifiers(t)),this.ws?.send(n)}),this.canvas.addEventListener("wheel",(t)=>{t.preventDefault();let e=new ArrayBuffer(6),n=new DataView(e);n.setUint8(0,S.MOUSE_SCROLL),n.setInt16(1,Math.round(t.deltaX),!0),n.setInt16(3,Math.round(t.deltaY),!0),n.setUint8(5,this.getModifiers(t)),this.ws?.send(e)}),this.canvas.addEventListener("contextmenu",(t)=>t.preventDefault())}getModifiers(t){let e=0;if(t.shiftKey)e|=1;if(t.ctrlKey)e|=2;if(t.altKey)e|=4;if(t.metaKey)e|=8;return e}sendKeyInput(t,e,n,i){if(!this.ws||this.ws.readyState!==WebSocket.OPEN)return;let s=i?new TextEncoder().encode(i):new Uint8Array(0),r=new ArrayBuffer(8+s.length),o=new DataView(r);o.setUint8(0,S.KEY_INPUT),o.setUint32(1,t,!0),o.setUint8(5,e),o.setUint8(6,n),o.setUint8(7,s.length),new Uint8Array(r).set(s,8),this.ws.send(r)}sendMouseInput(t,e,n,i,s){if(!this.ws||this.ws.readyState!==WebSocket.OPEN)return;let r=new ArrayBuffer(8),o=new DataView(r);o.setUint8(0,S.MOUSE_INPUT),o.setUint16(1,Math.round(t),!0),o.setUint16(3,Math.round(e),!0),o.setUint8(5,n),o.setUint8(6,i),o.setUint8(7,s),this.ws.send(r)}sendTextInput(t){if(!this.ws||this.ws.readyState!==WebSocket.OPEN)return;let e=new TextEncoder().encode(t),n=new ArrayBuffer(3+e.length),i=new DataView(n);i.setUint8(0,S.TEXT_INPUT),i.setUint16(1,e.length,!0),new Uint8Array(n).set(e,3),this.ws.send(n)}requestKeyframe(){if(!this.ws||this.ws.readyState!==WebSocket.OPEN)return;let t=new ArrayBuffer(1);new DataView(t).setUint8(0,S.REQUEST_KEYFRAME),this.ws.send(t)}focus(){this.canvas.focus()}reparent(t){this.container=t,t.appendChild(this.element),setTimeout(()=>{let e=this.container.getBoundingClientRect(),n=Math.floor(e.width),i=Math.floor(e.height);if(n>0&&i>0&&(n!==this.lastReportedWidth||i!==this.lastReportedHeight)){if(this.lastReportedWidth=n,this.lastReportedHeight=i,this.serverId!==null&&this.callbacks.onResize)this.callbacks.onResize(this.serverId,n,i)}},0)}destroy(){this.disconnect(),this.resizeObserver?.disconnect(),this.prevBuffer?.destroy(),this.diffBuffer?.destroy(),this.texture?.destroy(),this.element.remove()}}class k{parent;direction=null;first=null;second=null;panel=null;ratio=0.5;element;divider=null;isDragging=!1;constructor(t=null){this.parent=t,this.element=document.createElement("div")}static createLeaf(t,e=null){let n=new k(e);return n.panel=t,n.element=document.createElement("div"),n.element.className="split-pane",n.element.style.flex="1",t.reparent(n.element),n}split(t,e){if(this.direction!==null)return console.error("Cannot split a non-leaf container directly"),null;let n=t==="left"||t==="right",i=t==="left"||t==="up",s=this.panel;if(this.panel=null,this.direction=n?"horizontal":"vertical",i)this.first=k.createLeaf(e,this),this.second=k.createLeaf(s,this);else this.first=k.createLeaf(s,this),this.second=k.createLeaf(e,this);return this.rebuildDOM(),i?this.first:this.second}rebuildDOM(){let t=this.element.parentElement,e=this.element;if(this.element=document.createElement("div"),this.element.className=`split-container ${this.direction}`,this.element.appendChild(this.first.element),this.divider=document.createElement("div"),this.divider.className="split-divider",this.setupDividerDrag(),this.element.appendChild(this.divider),this.element.appendChild(this.second.element),this.applyRatio(),t)t.replaceChild(this.element,e)}setupDividerDrag(){let t=0,e=0,n=0,i=(o)=>{o.preventDefault(),this.isDragging=!0,this.divider.classList.add("dragging");let c=this.element.getBoundingClientRect();if(this.direction==="horizontal")t=o.clientX,n=c.width;else t=o.clientY,n=c.height;e=this.ratio,document.addEventListener("mousemove",s),document.addEventListener("mouseup",r)},s=(o)=>{if(!this.isDragging)return;let c;if(this.direction==="horizontal")c=o.clientX-t;else c=o.clientY-t;let a=n-4,d=c/a;this.ratio=Math.max(0.1,Math.min(0.9,e+d)),this.applyRatio()},r=()=>{this.isDragging=!1,this.divider.classList.remove("dragging"),document.removeEventListener("mousemove",s),document.removeEventListener("mouseup",r)};this.divider.addEventListener("mousedown",i)}applyRatio(){if(!this.first||!this.second)return;let t=(this.ratio*100).toFixed(2),e=((1-this.ratio)*100).toFixed(2);this.first.element.style.flex=`0 0 calc(${t}% - 2px)`,this.second.element.style.flex=`0 0 calc(${e}% - 2px)`}findContainer(t){if(this.panel===t)return this;if(this.first){let e=this.first.findContainer(t);if(e)return e}if(this.second){let e=this.second.findContainer(t);if(e)return e}return null}getAllPanels(){let t=[];if(this.panel)t.push(this.panel);if(this.first)t.push(...this.first.getAllPanels());if(this.second)t.push(...this.second.getAllPanels());return t}removePanel(t){if(this.panel===t)return!0;if(this.first&&this.first.panel===t){let e=this.first;if(this.promoteChild(this.second),e.element)e.element.remove();return!0}if(this.second&&this.second.panel===t){let e=this.second;if(this.promoteChild(this.first),e.element)e.element.remove();return!0}if(this.first&&this.first.removePanel(t))return!0;if(this.second&&this.second.removePanel(t))return!0;return!1}promoteChild(t){if(this.divider)this.divider.remove(),this.divider=null;if(t.direction!==null){if(this.direction=t.direction,this.first=t.first,this.second=t.second,this.ratio=t.ratio,this.divider=t.divider,this.panel=null,this.first)this.first.parent=this;if(this.second)this.second.parent=this;this.rebuildDOM()}else{this.direction=null,this.first=null,this.second=null,this.panel=t.panel;let e=this.element.parentElement,n=this.element;if(this.element=document.createElement("div"),this.element.className="split-pane",this.element.style.flex="1",this.panel.reparent(this.element),e)e.replaceChild(this.element,n)}}destroy(){if(this.panel)this.panel.destroy();if(this.first)this.first.destroy();if(this.second)this.second.destroy();if(this.element&&this.element.parentElement)this.element.remove()}}var v={TRANSFER_INIT:32,FILE_LIST_REQUEST:33,FILE_DATA:34,TRANSFER_RESUME:35,TRANSFER_CANCEL:36,TRANSFER_READY:48,FILE_LIST:49,FILE_REQUEST:50,FILE_ACK:51,TRANSFER_COMPLETE:52,TRANSFER_ERROR:53,DRY_RUN_REPORT:54};class L{ws=null;activeTransfers=new Map;chunkSize=262144;onTransferComplete;onTransferError;onDryRunReport;connect(t,e){this.ws=new WebSocket(`ws://${t}:${e}`),this.ws.binaryType="arraybuffer",this.ws.onopen=()=>{console.log("File transfer channel connected")},this.ws.onmessage=(n)=>{if(n.data instanceof ArrayBuffer)this.handleMessage(n.data)},this.ws.onclose=()=>{console.log("File transfer channel disconnected")}}disconnect(){this.ws?.close(),this.ws=null}handleMessage(t){switch(new DataView(t).getUint8(0)){case v.TRANSFER_READY:this.handleTransferReady(t);break;case v.FILE_LIST:this.handleFileList(t);break;case v.FILE_REQUEST:this.handleFileRequest(t);break;case v.FILE_ACK:this.handleFileAck(t);break;case v.TRANSFER_COMPLETE:this.handleTransferComplete(t);break;case v.TRANSFER_ERROR:this.handleTransferError(t);break;case v.DRY_RUN_REPORT:this.handleDryRunReport(t);break}}handleTransferReady(t){let n=new DataView(t).getUint32(1,!0);console.log(`Transfer ${n} ready`);let i=this.activeTransfers.get(n);if(i)i.state="ready"}handleFileList(t){let e=new DataView(t),n=new Uint8Array(t),i=1,s=e.getUint32(i,!0);i+=4;let r=e.getUint32(i,!0);i+=4;let o=Number(e.getBigUint64(i,!0));i+=8;let c=[];for(let a=0;a<r;a++){let d=e.getUint16(i,!0);i+=2;let f=new TextDecoder().decode(n.slice(i,i+d));i+=d;let u=Number(e.getBigUint64(i,!0));i+=8;let p=Number(e.getBigUint64(i,!0));i+=8;let h=e.getBigUint64(i,!0);i+=8;let m=n[i]!==0;i+=1,c.push({path:f,size:u,mtime:p,hash:h,isDir:m})}let l=this.activeTransfers.get(s);if(l)l.files=c,l.totalBytes=o,l.currentFileIndex=0,l.bytesTransferred=0,l.state="transferring"}async handleFileRequest(t){let e=new DataView(t),n=new Uint8Array(t),i=1,s=e.getUint32(i,!0);i+=4;let r=e.getUint32(i,!0);i+=4;let o=Number(e.getBigUint64(i,!0));i+=8,i+=4;let c=n.slice(i),l=this.activeTransfers.get(s);if(!l||!l.files)return;try{let a=await this.decompress(c),d=l.files[r];if(!l.receivedFiles)l.receivedFiles=new Map;if(!l.receivedFiles.has(r))l.receivedFiles.set(r,[]);if(l.receivedFiles.get(r).push({offset:o,data:a}),l.bytesTransferred+=a.length,l.bytesTransferred>=d.size){let f=l.receivedFiles.get(r);f.sort((h,m)=>h.offset-m.offset);let u=new Uint8Array(d.size),p=0;for(let h of f)u.set(h.data,p),p+=h.data.length;this.saveFile(d.path,u),l.receivedFiles.delete(r),l.currentFileIndex++}}catch(a){console.error("Decompression failed:",a)}}handleFileAck(t){let e=new DataView(t),n=e.getUint32(1,!0),i=Number(e.getBigUint64(9,!0)),s=this.activeTransfers.get(n);if(s)s.bytesTransferred=i,this.sendNextChunk(n)}handleTransferComplete(t){let e=new DataView(t),n=e.getUint32(1,!0),i=Number(e.getBigUint64(5,!0));console.log(`Transfer ${n} complete`);let s=this.activeTransfers.get(n);if(s)s.state="complete";this.activeTransfers.delete(n),this.onTransferComplete?.(n,i)}handleTransferError(t){let e=new DataView(t),n=new Uint8Array(t),i=e.getUint32(1,!0),s=e.getUint16(5,!0),r=new TextDecoder().decode(n.slice(7,7+s));console.error(`Transfer ${i} error: ${r}`),this.activeTransfers.delete(i),this.onTransferError?.(i,r)}handleDryRunReport(t){let e=new DataView(t),n=new Uint8Array(t),i=1,s=e.getUint32(i,!0);i+=4;let r=e.getUint32(i,!0);i+=4;let o=e.getUint32(i,!0);i+=4;let c=e.getUint32(i,!0);i+=4;let l=[];while(i<t.byteLength){let a=n[i];i+=1;let d=e.getUint16(i,!0);i+=2;let f=new TextDecoder().decode(n.slice(i,i+d));i+=d;let u=Number(e.getBigUint64(i,!0));i+=8,l.push({action:["create","update","delete"][a],path:f,size:u})}this.onDryRunReport?.(s,{newCount:r,updateCount:o,deleteCount:c,entries:l})}async startFolderUpload(t,e,n={}){if(!this.ws||this.ws.readyState!==WebSocket.OPEN){console.error("File transfer WebSocket not connected");return}let{deleteExtra:i=!1,dryRun:s=!1,excludes:r=[]}=n,o=await this.collectFilesFromHandle(t,""),c=new TextEncoder().encode(e),l=r.map((y)=>new TextEncoder().encode(y)),a=l.reduce((y,O)=>y+1+O.length,0),d=6+c.length+a,f=new ArrayBuffer(d),u=new DataView(f),p=new Uint8Array(f),h=0;u.setUint8(h,v.TRANSFER_INIT),h+=1,u.setUint8(h,0),h+=1,u.setUint8(h,(i?1:0)|(s?2:0)),h+=1,u.setUint8(h,r.length),h+=1,u.setUint16(h,c.length,!0),h+=2,p.set(c,h),h+=c.length;for(let y of l)u.setUint8(h,y.length),h+=1,p.set(y,h),h+=y.length;this.ws.send(f);let m=Date.now();this.activeTransfers.set(m,{id:m,direction:"upload",files:o,dirHandle:t,options:n,state:"pending",bytesTransferred:0,currentFileIndex:0})}async startFolderDownload(t,e={}){if(!this.ws||this.ws.readyState!==WebSocket.OPEN){console.error("File transfer WebSocket not connected");return}let{deleteExtra:n=!1,dryRun:i=!1,excludes:s=[]}=e,r=new TextEncoder().encode(t),o=s.map((h)=>new TextEncoder().encode(h)),c=o.reduce((h,m)=>h+1+m.length,0),l=6+r.length+c,a=new ArrayBuffer(l),d=new DataView(a),f=new Uint8Array(a),u=0;d.setUint8(u,v.TRANSFER_INIT),u+=1,d.setUint8(u,1),u+=1,d.setUint8(u,(n?1:0)|(i?2:0)),u+=1,d.setUint8(u,s.length),u+=1,d.setUint16(u,r.length,!0),u+=2,f.set(r,u),u+=r.length;for(let h of o)d.setUint8(u,h.length),u+=1,f.set(h,u),u+=h.length;this.ws.send(a);let p=Date.now();this.activeTransfers.set(p,{id:p,direction:"download",serverPath:t,options:e,state:"pending",bytesTransferred:0,currentFileIndex:0})}async collectFilesFromHandle(t,e){let n=[];for await(let[i,s]of t.entries()){let r=e?`${e}/${i}`:i;if(s.kind==="directory"){n.push({path:r,isDir:!0,size:0});let o=await this.collectFilesFromHandle(s,r);n.push(...o)}else{let o=s,c=await o.getFile();n.push({path:r,isDir:!1,size:c.size,handle:o,file:c})}}return n}async sendNextChunk(t){let e=this.activeTransfers.get(t);if(!e||e.direction!=="upload"||!e.files)return;let n=e.files[e.currentFileIndex];if(!n||n.isDir){if(e.currentFileIndex++,e.currentFileIndex<e.files.length)this.sendNextChunk(t);return}if(!n.file)return;let i=await n.file.arrayBuffer(),s=e.currentChunkOffset||0,r=Math.min(s+this.chunkSize,i.byteLength),o=new Uint8Array(i.slice(s,r)),c=await this.compress(o),l=21+c.length,a=new ArrayBuffer(l),d=new DataView(a),f=new Uint8Array(a),u=0;if(d.setUint8(u,v.FILE_DATA),u+=1,d.setUint32(u,e.id,!0),u+=4,d.setUint32(u,e.currentFileIndex,!0),u+=4,d.setBigUint64(u,BigInt(s),!0),u+=8,d.setUint32(u,o.length,!0),u+=4,f.set(c,u),this.ws?.send(a),e.currentChunkOffset=r,r>=i.byteLength)e.currentFileIndex++,e.currentChunkOffset=0}async compress(t){let e=new CompressionStream("deflate-raw"),n=e.writable.getWriter();n.write(t),n.close();let i=[],s=e.readable.getReader();while(!0){let{done:l,value:a}=await s.read();if(l)break;i.push(a)}let r=i.reduce((l,a)=>l+a.length,0),o=new Uint8Array(r),c=0;for(let l of i)o.set(l,c),c+=l.length;return o}async decompress(t){let e=new DecompressionStream("deflate-raw"),n=e.writable.getWriter();n.write(t),n.close();let i=[],s=e.readable.getReader();while(!0){let{done:l,value:a}=await s.read();if(l)break;i.push(a)}let r=i.reduce((l,a)=>l+a.length,0),o=new Uint8Array(r),c=0;for(let l of i)o.set(l,c),c+=l.length;return o}saveFile(t,e){let n=t.split("/").pop()||t,i=new Blob([e]),s=URL.createObjectURL(i),r=document.createElement("a");r.href=s,r.download=n,document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(s)}}function F(t){let e=t.match(/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i);return e?{r:parseInt(e[1],16),g:parseInt(e[2],16),b:parseInt(e[3],16)}:null}function D(t,e,n){return`#${Math.round(t).toString(16).padStart(2,"0")}${Math.round(e).toString(16).padStart(2,"0")}${Math.round(n).toString(16).padStart(2,"0")}`}function M(t){let e=F(t);if(!e)return 0;return 0.299*e.r/255+0.587*e.g/255+0.114*e.b/255}function K(t){return M(t)>0.5}function it(t){return M(t)<0.05}function st(t,e){let n=F(t);if(!n)return t;let i=n.r+(255-n.r)*e,s=n.g+(255-n.g)*e,r=n.b+(255-n.b)*e;return D(i,s,r)}function Q(t,e){let n=F(t);if(!n)return t;let i=n.r*(1-e),s=n.g*(1-e),r=n.b*(1-e);return D(i,s,r)}function rt(t,e){let n=F(t);if(!n)return t;let i=n.r*(1-e),s=n.g*(1-e),r=n.b*(1-e);return D(i,s,r)}function U(t){if(t<1024)return`${t} B`;if(t<1048576)return`${(t/1024).toFixed(1)} KB`;if(t<1073741824)return`${(t/1048576).toFixed(1)} MB`;return`${(t/1073741824).toFixed(2)} GB`}function w(){return Math.random().toString(36).substring(2,9)}function ot(t,e){let n=null;return(...i)=>{if(n)clearTimeout(n);n=setTimeout(()=>t(...i),e)}}function lt(t,e){let n=!1;return(...i)=>{if(!n)t(...i),n=!0,setTimeout(()=>n=!1,e)}}function N(t){let e=document.documentElement,n=t.background||"#282c34",i=t.foreground||"#ffffff",s=K(n);e.style.setProperty("--bg",n),e.style.setProperty("--toolbar-bg",n);let r=Q(n,0.1);e.style.setProperty("--tabbar-bg",r),e.style.setProperty("--tab-active",n),e.style.setProperty("--text",i);let o=s?"0,0,0":"255,255,255";e.style.setProperty("--tab-hover",`rgba(${o},0.08)`),e.style.setProperty("--close-hover",`rgba(${o},0.1)`),e.style.setProperty("--text-dim",`rgba(${o},0.5)`),e.style.setProperty("--accent",i);for(let c=0;c<16;c++){let l=`palette${c}`;if(t[l])e.style.setProperty(`--palette-${c}`,t[l])}}function ct(){let t={},e=window.location.search.substring(1);if(!e)return t;for(let n of e.split("&")){let[i,s]=n.split("=");if(i)t[decodeURIComponent(i)]=decodeURIComponent(s||"")}return t}function ut(t,...e){let n=1;for(let c of e)n+=typeof c==="number"?1:c.length;let i=new ArrayBuffer(n),s=new DataView(i),r=new Uint8Array(i),o=0;s.setUint8(o++,t);for(let c of e)if(typeof c==="number")s.setUint8(o++,c);else r.set(c,o),o+=c.length;return i}function at(t,e){return t.getUint16(e,!0)}function dt(t,e){return t.getUint32(e,!0)}function ht(t,e,n){t.setUint16(e,n,!0)}function ft(t,e,n){t.setUint32(e,n,!0)}function Y(){return[{title:"Copy to Clipboard",action:"copy_to_clipboard",description:"Copy selected text"},{title:"Paste from Clipboard",action:"paste_from_clipboard",description:"Paste contents of clipboard"},{title:"Paste from Selection",action:"paste_from_selection",description:"Paste from selection clipboard"},{title:"Select All",action:"select_all",description:"Select all text"},{title:"Increase Font Size",action:"increase_font_size:1",description:"Make text larger",shortcut:"⌘="},{title:"Decrease Font Size",action:"decrease_font_size:1",description:"Make text smaller",shortcut:"⌘-"},{title:"Reset Font Size",action:"reset_font_size",description:"Reset to default size",shortcut:"⌘0"},{title:"Clear Screen",action:"clear_screen",description:"Clear screen and scrollback"},{title:"Scroll to Top",action:"scroll_to_top",description:"Scroll to top of buffer"},{title:"Scroll to Bottom",action:"scroll_to_bottom",description:"Scroll to bottom of buffer"},{title:"Scroll Page Up",action:"scroll_page_up",description:"Scroll up one page"},{title:"Scroll Page Down",action:"scroll_page_down",description:"Scroll down one page"},{title:"New Tab",action:"_new_tab",description:"Open a new tab",shortcut:"⌘/"},{title:"Close Tab",action:"_close_tab",description:"Close current tab",shortcut:"⌘."},{title:"Show All Tabs",action:"_show_all_tabs",description:"Show tab overview",shortcut:"⌘⇧A"},{title:"Split Right",action:"_split_right",description:"Split pane to the right",shortcut:"⌘D"},{title:"Split Down",action:"_split_down",description:"Split pane downward",shortcut:"⌘⇧D"},{title:"Split Left",action:"_split_left",description:"Split pane to the left"},{title:"Split Up",action:"_split_up",description:"Split pane upward"},{title:"Focus Split: Left",action:"goto_split:left",description:"Focus left split"},{title:"Focus Split: Right",action:"goto_split:right",description:"Focus right split"},{title:"Focus Split: Up",action:"goto_split:up",description:"Focus split above"},{title:"Focus Split: Down",action:"goto_split:down",description:"Focus split below"},{title:"Focus Split: Previous",action:"goto_split:previous",description:"Focus previous split"},{title:"Focus Split: Next",action:"goto_split:next",description:"Focus next split"},{title:"Toggle Split Zoom",action:"toggle_split_zoom",description:"Toggle zoom on current split"},{title:"Equalize Splits",action:"equalize_splits",description:"Make all splits equal size"},{title:"Reset Terminal",action:"reset",description:"Reset terminal state"},{title:"Toggle Read-Only Mode",action:"toggle_readonly",description:"Toggle read-only mode"},{title:"Reload Config",action:"reload_config",description:"Reload configuration"},{title:"Toggle Inspector",action:"_toggle_inspector",description:"Toggle terminal inspector",shortcut:"⌥⌘I"},{title:"Change Title...",action:"_change_title",description:"Change the terminal title"},{title:"Ghostty",action:"text:\uD83D\uDC7B",description:"Add a little ghost to your terminal"}].sort((e,n)=>e.title.localeCompare(n.title))}class R{overlay=null;input=null;list=null;commands=[];filteredCommands=[];selectedIndex=0;onExecute;constructor(t){this.onExecute=t,this.commands=Y()}show(){if(this.overlay=document.getElementById("command-palette"),!this.overlay)return;if(this.input=this.overlay.querySelector(".command-input"),this.list=this.overlay.querySelector(".command-list"),this.input)this.input.value="",this.input.oninput=()=>this.renderList(this.input.value),this.input.onkeydown=(t)=>this.handleKeydown(t);this.selectedIndex=0,this.renderList(""),this.overlay.classList.add("visible"),this.input?.focus(),this.overlay.onclick=(t)=>{if(t.target===this.overlay)this.hide()}}hide(){this.overlay?.classList.remove("visible")}renderList(t){if(!this.list)return;let e=t.toLowerCase();this.filteredCommands=this.commands.filter((n)=>n.title.toLowerCase().includes(e)||n.description.toLowerCase().includes(e)),this.selectedIndex=Math.min(this.selectedIndex,Math.max(0,this.filteredCommands.length-1)),this.list.innerHTML=this.filteredCommands.map((n,i)=>`
      <div class="command-item ${i===this.selectedIndex?"selected":""}" data-index="${i}">
        <div class="command-title">${n.title}</div>
        <div class="command-desc">${n.description}</div>
        ${n.shortcut?`<div class="command-shortcut">${n.shortcut}</div>`:""}
      </div>
    `).join(""),this.list.querySelectorAll(".command-item").forEach((n,i)=>{n.addEventListener("click",()=>this.executeIndex(i)),n.addEventListener("mouseenter",()=>{this.selectedIndex=i,this.updateSelection()})})}updateSelection(){if(!this.list)return;this.list.querySelectorAll(".command-item").forEach((t,e)=>{t.classList.toggle("selected",e===this.selectedIndex)})}handleKeydown(t){switch(t.key){case"ArrowDown":t.preventDefault(),this.selectedIndex=Math.min(this.selectedIndex+1,this.filteredCommands.length-1),this.updateSelection();break;case"ArrowUp":t.preventDefault(),this.selectedIndex=Math.max(this.selectedIndex-1,0),this.updateSelection();break;case"Enter":t.preventDefault(),this.executeIndex(this.selectedIndex);break;case"Escape":t.preventDefault(),this.hide();break}}executeIndex(t){let e=this.filteredCommands[t];if(e)this.hide(),this.onExecute?.(e.action)}}class A{overlay=null;onUpload;constructor(t){this.onUpload=t}show(){if(this.overlay=document.getElementById("upload-dialog"),!this.overlay)return;let t=this.overlay.querySelector(".upload-dropzone"),e=this.overlay.querySelector('input[type="file"]');if(t)t.ondragover=(i)=>{i.preventDefault(),t.classList.add("dragover")},t.ondragleave=()=>{t.classList.remove("dragover")},t.ondrop=(i)=>{i.preventDefault(),t.classList.remove("dragover");let s=i.dataTransfer?.files;if(s&&s.length>0)this.uploadFile(s[0])},t.onclick=()=>e?.click();if(e)e.onchange=()=>{if(e.files&&e.files.length>0)this.uploadFile(e.files[0])};this.overlay.classList.add("visible"),this.overlay.querySelector(".dialog-btn.cancel")?.addEventListener("click",()=>this.hide()),this.overlay.onclick=(i)=>{if(i.target===this.overlay)this.hide()}}hide(){this.overlay?.classList.remove("visible")}uploadFile(t){this.hide(),this.onUpload?.(t)}}class _{overlay=null;onDownload;constructor(t){this.onDownload=t}show(){if(this.overlay=document.getElementById("download-dialog"),!this.overlay)return;let t=this.overlay.querySelector(".download-input"),e=this.overlay.querySelector(".dialog-btn.primary");if(t)t.value="",t.focus(),t.onkeydown=(i)=>{if(i.key==="Enter")i.preventDefault(),this.download(t.value);else if(i.key==="Escape")i.preventDefault(),this.hide()};e?.addEventListener("click",()=>{if(t)this.download(t.value)}),this.overlay.classList.add("visible"),this.overlay.querySelector(".dialog-btn.cancel")?.addEventListener("click",()=>this.hide()),this.overlay.onclick=(i)=>{if(i.target===this.overlay)this.hide()}}hide(){this.overlay?.classList.remove("visible")}download(t){if(t.trim())this.hide(),this.onDownload?.(t.trim())}}class C{overlay=null;sessions=[];shareLinks=[];onSetPassword;onCreateSession;onRegenerateToken;onCreateShareLink;onRevokeShareLink;onRevokeAllShares;show(){if(this.overlay=document.getElementById("access-control-dialog"),!this.overlay)return;this.setupHandlers(),this.overlay.classList.add("visible")}hide(){this.overlay?.classList.remove("visible")}updateSessions(t){this.sessions=t,this.renderSessions()}updateShareLinks(t){this.shareLinks=t,this.renderShareLinks()}setupHandlers(){if(!this.overlay)return;let t=this.overlay.querySelector("#admin-password-input");this.overlay.querySelector("#set-password-btn")?.addEventListener("click",()=>{if(t?.value)this.onSetPassword?.(t.value),t.value=""});let n=this.overlay.querySelector("#new-session-name");this.overlay.querySelector("#create-session-btn")?.addEventListener("click",()=>{let r=n?.value.trim();if(r){let o=r.toLowerCase().replace(/[^a-z0-9]/g,"-");this.onCreateSession?.(o,r),n.value=""}}),this.overlay.querySelector("#generate-editor-link")?.addEventListener("click",()=>{this.onCreateShareLink?.(1)}),this.overlay.querySelector("#generate-viewer-link")?.addEventListener("click",()=>{this.onCreateShareLink?.(2)}),this.overlay.querySelector("#revoke-all-btn")?.addEventListener("click",()=>{this.onRevokeAllShares?.()}),this.overlay.querySelector(".dialog-btn.cancel")?.addEventListener("click",()=>this.hide()),this.overlay.onclick=(r)=>{if(r.target===this.overlay)this.hide()}}renderSessions(){let t=document.getElementById("sessions-list");if(!t)return;t.innerHTML="";for(let e of this.sessions){let n=document.createElement("div");n.className="session-item",n.innerHTML=`
        <span class="session-name">${e.name}</span>
        <div class="token-group">
          <span class="token editor" title="Click to copy editor link" data-token="${e.editorToken}">Editor</span>
          <span class="token viewer" title="Click to copy viewer link" data-token="${e.viewerToken}">Viewer</span>
          <button class="regen-btn" data-session="${e.id}" data-type="editor" title="Regenerate editor token">\uD83D\uDD04</button>
        </div>
      `,n.querySelectorAll(".token").forEach((s)=>{s.onclick=()=>{let r=`${location.origin}?token=${s.dataset.token}`;navigator.clipboard.writeText(r).then(()=>{s.style.background="rgba(100,200,100,0.3)",setTimeout(()=>s.style.background="",500)})}});let i=n.querySelector(".regen-btn");i.onclick=()=>{this.onRegenerateToken?.(i.dataset.session,1)},t.appendChild(n)}}renderShareLinks(){let t=document.getElementById("share-links-list");if(!t)return;t.innerHTML="";for(let e of this.shareLinks){let n=e.type===1?"Editor":"Viewer",i=e.type===1?"editor":"viewer",s=document.createElement("div");s.className="share-link-item",s.innerHTML=`
        <div style="display: flex; align-items: center; gap: 8px;">
          <span class="link-type ${i}">${n}</span>
          <span class="link-token" title="Click to copy" style="font-family: monospace; font-size: 11px; cursor: pointer;">${e.token.slice(0,12)}...</span>
        </div>
        <div style="display: flex; align-items: center; gap: 8px;">
          <span class="link-uses">${e.useCount} uses</span>
          <button class="revoke-btn" data-token="${e.token}" style="padding: 2px 6px; font-size: 11px;">Revoke</button>
        </div>
      `;let r=s.querySelector(".link-token");r.onclick=()=>{navigator.clipboard.writeText(`${location.origin}?token=${e.token}`)};let o=s.querySelector(".revoke-btn");o.onclick=()=>{this.onRevokeShareLink?.(o.dataset.token)},t.appendChild(s)}if(this.shareLinks.length===0)t.innerHTML='<div style="color: var(--text-dim); font-size: 12px; padding: 8px;">No active share links</div>'}}var H=0,q=0,x=0;class B{controlWs=null;fileTransfer;panels=new Map;tabs=new Map;tabHistory=[];activePanel=null;activeTab=null;host;nextTabId=1;pendingSplit=null;tabsEl=null;panelsEl=null;statusDot=null;commandPalette;uploadDialog;downloadDialog;accessControlDialog;sessions=[];shareLinks=[];tabOverviewTabs=null;tabOverviewCloseHandler=null;constructor(){this.host=window.location.hostname||"localhost",this.fileTransfer=new L,this.commandPalette=new R((t)=>this.executeCommand(t)),this.uploadDialog=new A((t)=>this.uploadFile(t)),this.downloadDialog=new _((t)=>this.requestDownload(t)),this.accessControlDialog=new C,this.setupAccessControlCallbacks()}async init(){this.tabsEl=document.getElementById("tabs"),this.panelsEl=document.getElementById("panels"),this.statusDot=document.getElementById("status-dot"),document.getElementById("new-tab")?.addEventListener("click",()=>this.createTab()),document.getElementById("show-all-tabs")?.addEventListener("click",()=>this.showTabOverview());let t=await this.fetchConfig();if(H=t.panelWsPort,q=t.controlWsPort,x=t.fileWsPort,t.colors)N(t.colors);if(this.connectControl(),x)this.fileTransfer.connect(this.host,x);this.createTab(),this.setupShortcuts(),this.setupMenus()}async fetchConfig(){return(await fetch("/config")).json()}setStatus(t,e){if(this.statusDot)this.statusDot.className=`status-dot ${t}`}connectControl(){let t=`ws://${this.host}:${q}`;this.controlWs=new WebSocket(t),this.controlWs.binaryType="arraybuffer",this.controlWs.onopen=()=>{console.log("Control channel connected"),this.setStatus("connected")},this.controlWs.onmessage=(e)=>{if(typeof e.data==="string")this.handleJsonMessage(JSON.parse(e.data));else if(e.data instanceof ArrayBuffer)this.handleBinaryMessage(e.data)},this.controlWs.onclose=()=>{console.log("Control channel disconnected"),this.setStatus("disconnected"),setTimeout(()=>this.connectControl(),1000)},this.controlWs.onerror=()=>{this.setStatus("error")}}handleJsonMessage(t){switch(t.type){case"auth_state":this.handleAuthState(t);break;case"sessions":this.handleSessionList(t.sessions);break;case"share_links":this.handleShareLinks(t.links);break;case"auth_error":console.error("Auth error:",t.message);break}}handleBinaryMessage(t){switch(new DataView(t).getUint8(0)){case 1:this.handlePanelCreated(t);break;case 2:this.handlePanelClosed(t);break;case 3:this.handleTitleChanged(t);break;case 4:this.handlePwdChanged(t);break;case 5:this.handleBell(t);break;case 18:this.handleFileData(t);break;case 21:this.handleFolderData(t);break}}handlePanelCreated(t){let n=new DataView(t).getUint32(1,!0);if(this.pendingSplit)this.completePendingSplit(n)}handlePanelClosed(t){let n=new DataView(t).getUint32(1,!0);for(let[i,s]of this.panels)if(s.serverId===n){this.panels.delete(i),s.destroy();break}}handleTitleChanged(t){let e=new DataView(t),n=new Uint8Array(t),i=e.getUint32(1,!0),s=e.getUint16(5,!0),r=new TextDecoder().decode(n.slice(7,7+s));this.updatePanelTitle(i,r)}handlePwdChanged(t){let e=new DataView(t),n=new Uint8Array(t),i=e.getUint32(1,!0),s=e.getUint16(5,!0),r=new TextDecoder().decode(n.slice(7,7+s));this.updatePanelPwd(i,r)}handleBell(t){let n=new DataView(t).getUint32(1,!0);this.handlePanelBell(n)}handleFileData(t){let e=new DataView(t),n=new Uint8Array(t),i=1,s=e.getUint16(i,!0);i+=2;let r=new TextDecoder().decode(n.slice(i,i+s));i+=s;let o=n.slice(i);this.triggerDownload(r,o)}handleFolderData(t){let e=new DataView(t),n=new Uint8Array(t),i=1,s=e.getUint16(i,!0);i+=2;let r=new TextDecoder().decode(n.slice(i,i+s));i+=s;let o=n.slice(i);this.triggerDownload(r,o)}triggerDownload(t,e){let n=new Blob([e]),i=URL.createObjectURL(n),s=document.createElement("a");s.href=i,s.download=t,document.body.appendChild(s),s.click(),document.body.removeChild(s),URL.revokeObjectURL(i),console.log(`Downloaded ${t}: ${U(e.length)}`)}createTab(t="Terminal"){let e=String(this.nextTabId++),n=document.createElement("div");n.className="tab-content",n.id=`tab-${e}`,this.panelsEl?.appendChild(n);let i=this.createPanel(n),s=k.createLeaf(i);return n.appendChild(s.element),this.tabs.set(e,{id:e,title:t,root:s,element:n}),this.addTabUI(e,t),this.switchToTab(e),e}createPanel(t,e=null){let n=w(),i=new E(n,t,e,{onResize:(s,r,o)=>this.sendResizePanel(s,r,o),onViewAction:(s,r)=>this.handleViewAction(i,s,r)});if(this.panels.set(n,i),i.connect(this.host,H),!this.activePanel)this.setActivePanel(i);return i}setActivePanel(t){if(this.activePanel=t,t.focus(),t.serverId!==null)this.sendFocusPanel(t.serverId);this.updateTitleForPanel(t)}switchToTab(t){if(this.activeTab)this.tabs.get(this.activeTab)?.element.classList.remove("active");let e=this.tabs.get(t);if(e){e.element.classList.add("active"),this.activeTab=t,this.updateTabUIActive(t);let n=this.tabHistory.indexOf(t);if(n!==-1)this.tabHistory.splice(n,1);this.tabHistory.push(t);let i=e.root.getAllPanels();if(i.length>0)this.setActivePanel(i[0])}}closeTab(t){let e=this.tabs.get(t);if(!e||this.tabs.size<=1)return;e.root.destroy(),e.element.remove(),this.removeTabUI(t),this.tabs.delete(t);let n=this.tabHistory.indexOf(t);if(n!==-1)this.tabHistory.splice(n,1);if(this.activeTab===t){let i=this.tabHistory[this.tabHistory.length-1]||Array.from(this.tabs.keys())[0];if(i)this.switchToTab(i)}}closeActivePanel(){if(!this.activePanel||!this.activeTab)return;let t=this.tabs.get(this.activeTab);if(!t)return;if(t.root.getAllPanels().length<=1){this.closeTab(this.activeTab);return}let n=this.activePanel;if(t.root.removePanel(n),n.serverId!==null)this.sendClosePanel(n.serverId);for(let[s,r]of this.panels)if(r===n){this.panels.delete(s);break}n.destroy();let i=t.root.getAllPanels();if(i.length>0)this.setActivePanel(i[0])}closeAllTabs(){let t=Array.from(this.tabs.keys());for(let e=0;e<t.length-1;e++)this.closeTab(t[e])}splitActivePanel(t){if(!this.activePanel||!this.activeTab)return;let e=this.tabs.get(this.activeTab);if(!e)return;let n=e.root.findContainer(this.activePanel);if(!n)return;let i=this.activePanel.canvas.getBoundingClientRect(),s=Math.floor(i.width/2),r=Math.floor(i.height/2);this.pendingSplit={parentPanelId:this.activePanel.serverId,direction:t,container:n},this.sendSplitPanel(this.activePanel.serverId,t,s,r)}completePendingSplit(t){if(!this.pendingSplit||!this.activeTab)return;let{direction:e,container:n}=this.pendingSplit,i=this.tabs.get(this.activeTab);if(!i)return;let s=this.createPanel(i.element,t);n.split(e,s),this.setActivePanel(s),this.pendingSplit=null}addTabUI(t,e){if(!this.tabsEl)return;let n=document.createElement("div");n.className="tab",n.dataset.id=t;let i=this.tabsEl.children.length+1,s=i<=9?`⌘${i}`:"",r=e||"\uD83D\uDC7B";n.innerHTML=`
      <span class="close">×</span>
      <span class="title-wrapper">
        <span class="indicator">•</span>
        <span class="title">${r}</span>
      </span>
      <span class="hotkey">${s}</span>
    `,n.addEventListener("click",(o)=>{if(!o.target.classList.contains("close"))this.switchToTab(t)}),n.querySelector(".close")?.addEventListener("click",(o)=>{o.stopPropagation(),this.closeTab(t)}),this.tabsEl.appendChild(n)}removeTabUI(t){this.tabsEl?.querySelector(`[data-id="${t}"]`)?.remove(),this.updateHotkeyHints()}updateHotkeyHints(){this.tabsEl?.querySelectorAll(".tab")?.forEach((e,n)=>{let i=e.querySelector(".hotkey");if(i)i.textContent=n<9?`⌘${n+1}`:""})}updateTabUIActive(t){if(!this.tabsEl)return;for(let e of Array.from(this.tabsEl.children))e.classList.toggle("active",e.dataset.id===t)}updateTitleForPanel(t){for(let[e,n]of this.tabs)if(n.root.findContainer(t)){let s=this.tabsEl?.querySelector(`[data-id="${e}"] .title`)?.textContent||"";document.title=s||"\uD83D\uDC7B";let r=document.getElementById("app-title");if(r)r.textContent=s||"\uD83D\uDC7B";break}}updatePanelTitle(t,e){let n=null;for(let[,s]of this.panels)if(s.serverId===t){n=s;break}if(!n)return;let i=this.findTabIdForPanel(n);if(i!==null){let s=this.tabsEl?.querySelector(`[data-id="${i}"] .title`);if(s)s.textContent=e;let r=this.tabsEl?.querySelector(`[data-id="${i}"] .indicator`);if(r){let c=this.isAtPrompt(n,e);r.textContent=c?"•":"✱"}let o=this.tabs.get(i);if(o)o.title=e}if(n===this.activePanel){document.title=e;let s=document.getElementById("app-title");if(s)s.textContent=e}}updatePanelPwd(t,e){for(let[,n]of this.panels)if(n.serverId===t){n.pwd=e;break}}isAtPrompt(t,e){if(!t.pwd||!e)return!0;let n=t.pwd.split("/").pop()||t.pwd;return e.includes(n)||e.includes("/")||e===t.pwd}findTabIdForPanel(t){for(let[e,n]of this.tabs)if(n.root.findContainer(t))return e;return null}handlePanelBell(t){let e=null;for(let[,i]of this.panels)if(i.serverId===t){e=i;break}if(!e)return;let n=this.findTabIdForPanel(e);if(n!==null){let i=this.tabsEl?.querySelector(`[data-id="${n}"]`);if(i&&!i.classList.contains("active"))i.classList.add("bell"),setTimeout(()=>i.classList.remove("bell"),500)}}showTabOverview(){let t=document.getElementById("tab-overview"),e=document.getElementById("tab-overview-grid");if(!t||!e||!this.panelsEl)return;e.innerHTML="",this.tabOverviewTabs=[];for(let[,d]of this.panels)d.resizeObserver?.disconnect();let n=this.panelsEl.getBoundingClientRect(),i=n.width/n.height,s=200,r=Math.round(s*i),o=Math.min(r/n.width,s/n.height),c=n.width*o,l=n.height*o;for(let[d,f]of this.tabs){let u=document.createElement("div");if(u.className="tab-preview",d===this.activeTab)u.classList.add("active");let p=document.createElement("div");p.className="tab-preview-content",p.style.cssText=`overflow: hidden; position: relative; width: ${c}px; height: ${l}px;`;let h=document.createElement("div");h.style.cssText=`
        width: ${n.width}px;
        height: ${n.height}px;
        transform: scale(${o});
        transform-origin: top left;
        pointer-events: none;
        position: absolute;
        top: 0;
        left: 0;
      `,f.element.style.display="flex",f.element.style.position="relative",f.element.style.width="100%",f.element.style.height="100%",h.appendChild(f.element),p.appendChild(h),this.tabOverviewTabs.push({tabId:d,tab:f,element:f.element});let m=document.createElement("div");m.className="tab-preview-title",m.innerHTML=`
        <span class="tab-preview-close">✕</span>
        <span class="tab-preview-title-text">
          <span class="tab-preview-indicator">•</span>
          <span class="tab-preview-title-label">${f.title||"\uD83D\uDC7B"}</span>
        </span>
        <span class="tab-preview-spacer"></span>
      `,m.querySelector(".tab-preview-close")?.addEventListener("click",(y)=>{if(y.stopPropagation(),this.restoreTabsFromOverview(),this.closeTab(d),this.tabs.size>0)this.showTabOverview();else this.hideTabOverview()}),u.appendChild(m),u.appendChild(p),u.addEventListener("click",()=>{this.hideTabOverview(),this.switchToTab(d)}),e.appendChild(u)}let a=document.createElement("div");a.className="tab-preview-new",a.style.cssText=`width: ${c}px; height: ${l+44}px;`,a.innerHTML='<span class="tab-preview-new-icon">+</span>',a.addEventListener("click",()=>{this.hideTabOverview(),this.createTab()}),e.appendChild(a),t.classList.add("visible"),this.tabOverviewCloseHandler=(d)=>{if(d.key==="Escape"||d.target===t)this.hideTabOverview()},document.addEventListener("keydown",this.tabOverviewCloseHandler),t.addEventListener("click",this.tabOverviewCloseHandler)}restoreTabsFromOverview(){if(!this.tabOverviewTabs||!this.panelsEl)return;for(let{element:t}of this.tabOverviewTabs)t.style.display="",t.style.position="",t.style.width="",t.style.height="",this.panelsEl.appendChild(t);this.tabOverviewTabs=null;for(let[,t]of this.panels)if(t.resizeObserver&&t.element)t.resizeObserver.observe(t.element)}hideTabOverview(){this.restoreTabsFromOverview();let t=document.getElementById("tab-overview");if(t){t.classList.remove("visible");let e=document.getElementById("tab-overview-grid");if(e)e.innerHTML="";if(this.tabOverviewCloseHandler)document.removeEventListener("keydown",this.tabOverviewCloseHandler),t.removeEventListener("click",this.tabOverviewCloseHandler),this.tabOverviewCloseHandler=null}if(this.activeTab!==null){let e=this.tabs.get(this.activeTab);if(e){for(let[,n]of this.tabs)n.element.classList.remove("active");e.element.classList.add("active")}}this.activePanel?.focus()}executeCommand(t){if(t.startsWith("_")){switch(t){case"_new_tab":this.createTab();break;case"_close_tab":this.closeActivePanel();break;case"_show_all_tabs":this.showTabOverview();break;case"_split_right":this.splitActivePanel("right");break;case"_split_down":this.splitActivePanel("down");break;case"_split_left":this.splitActivePanel("left");break;case"_split_up":this.splitActivePanel("up");break;case"_toggle_inspector":this.activePanel?.toggleInspector?.();break;case"_change_title":this.promptChangeTitle();break}return}if(this.activePanel&&this.activePanel.serverId!==null)this.sendViewAction(this.activePanel.serverId,t)}handleViewAction(t,e,n){console.log(`View action from panel ${t.id}:`,e,n)}sendFocusPanel(t){if(this.controlWs?.readyState===WebSocket.OPEN){let e=new ArrayBuffer(5),n=new DataView(e);n.setUint8(0,129),n.setUint32(1,t,!0),this.controlWs.send(e)}}sendResizePanel(t,e,n){if(this.controlWs?.readyState===WebSocket.OPEN){let i=new ArrayBuffer(13),s=new DataView(i);s.setUint8(0,130),s.setUint32(1,t,!0),s.setUint32(5,e,!0),s.setUint32(9,n,!0),this.controlWs.send(i)}}sendClosePanel(t){if(this.controlWs?.readyState===WebSocket.OPEN){let e=new ArrayBuffer(5),n=new DataView(e);n.setUint8(0,131),n.setUint32(1,t,!0),this.controlWs.send(e)}}sendSplitPanel(t,e,n,i){if(this.controlWs?.readyState===WebSocket.OPEN){let s={right:0,down:1,left:2,up:3}[e]??0,r=new ArrayBuffer(14),o=new DataView(r);o.setUint8(0,132),o.setUint32(1,t,!0),o.setUint8(5,s),o.setUint32(6,n,!0),o.setUint32(10,i,!0),this.controlWs.send(r)}}sendViewAction(t,e){if(this.controlWs?.readyState===WebSocket.OPEN){let n=new TextEncoder().encode(e),i=new ArrayBuffer(7+n.length),s=new DataView(i);s.setUint8(0,133),s.setUint32(1,t,!0),s.setUint16(5,n.length,!0),new Uint8Array(i).set(n,7),this.controlWs.send(i)}}requestDownload(t,e=!1){if(!this.activePanel?.serverId){console.error("No active panel for download");return}if(t.endsWith("/"))e=!0,t=t.slice(0,-1);let n=this.activePanel.serverId,i=new TextEncoder().encode(t),s=7+i.length,r=new ArrayBuffer(s),o=new DataView(r),c=new Uint8Array(r),l=0;o.setUint8(l,e?20:17),l+=1,o.setUint32(l,n,!0),l+=4,o.setUint16(l,i.length,!0),l+=2,c.set(i,l),this.controlWs?.send(r),console.log(`Requesting ${e?"folder":"file"} download: ${t}`)}uploadFile(t){if(!this.activePanel?.serverId){console.error("No active panel for upload");return}let e=new FileReader;e.onload=()=>{let n=new Uint8Array(e.result),i=new TextEncoder().encode(t.name),s=7+i.length+4+n.length,r=new ArrayBuffer(s),o=new DataView(r),c=new Uint8Array(r),l=0;o.setUint8(l,16),l+=1,o.setUint32(l,this.activePanel.serverId,!0),l+=4,o.setUint16(l,i.length,!0),l+=2,c.set(i,l),l+=i.length,o.setUint32(l,n.length,!0),l+=4,c.set(n,l),this.controlWs?.send(r),console.log(`Uploading ${t.name}: ${U(t.size)}`)},e.readAsArrayBuffer(t)}setupAccessControlCallbacks(){this.accessControlDialog.onSetPassword=(t)=>this.sendSetPassword(t),this.accessControlDialog.onCreateSession=(t,e)=>this.sendCreateSession(t,e),this.accessControlDialog.onRegenerateToken=(t,e)=>this.sendRegenerateToken(t,e),this.accessControlDialog.onCreateShareLink=(t)=>this.sendCreateShareLink(t),this.accessControlDialog.onRevokeShareLink=(t)=>this.sendRevokeShareLink(t),this.accessControlDialog.onRevokeAllShares=()=>this.sendRevokeAllShares()}handleAuthState(t){console.log("Auth state:",t)}handleSessionList(t){this.sessions=t,this.accessControlDialog.updateSessions(t)}handleShareLinks(t){this.shareLinks=t,this.accessControlDialog.updateShareLinks(t)}sendGetAuthState(){if(this.controlWs?.readyState===WebSocket.OPEN)this.controlWs.send(new Uint8Array([144]))}sendSetPassword(t){if(this.controlWs?.readyState===WebSocket.OPEN){let e=new TextEncoder().encode(t),n=new Uint8Array(3+e.length);n[0]=145,new DataView(n.buffer).setUint16(1,e.length,!0),n.set(e,3),this.controlWs.send(n)}}sendCreateSession(t,e){if(this.controlWs?.readyState===WebSocket.OPEN){let n=new TextEncoder().encode(t),i=new TextEncoder().encode(e),s=new Uint8Array(5+n.length+i.length);s[0]=147;let r=new DataView(s.buffer);r.setUint16(1,n.length,!0),r.setUint16(3,i.length,!0),s.set(n,5),s.set(i,5+n.length),this.controlWs.send(s)}}sendRegenerateToken(t,e){if(this.controlWs?.readyState===WebSocket.OPEN){let n=new TextEncoder().encode(t),i=new Uint8Array(4+n.length);i[0]=149,new DataView(i.buffer).setUint16(1,n.length,!0),i[3]=e,i.set(n,4),this.controlWs.send(i)}}sendCreateShareLink(t){if(this.controlWs?.readyState===WebSocket.OPEN)this.controlWs.send(new Uint8Array([150,t]))}sendRevokeShareLink(t){if(this.controlWs?.readyState===WebSocket.OPEN){let e=new TextEncoder().encode(t),n=new Uint8Array(1+e.length);n[0]=151,n.set(e,1),this.controlWs.send(n)}}sendRevokeAllShares(){if(this.controlWs?.readyState===WebSocket.OPEN)this.controlWs.send(new Uint8Array([152]))}promptChangeTitle(){let t=this.tabs.get(this.activeTab),e=t?.title||"",n=prompt("Enter new title:",e);if(n!==null&&this.activePanel&&this.activePanel.serverId!==null){if(this.sendViewAction(this.activePanel.serverId,`set_title:${n}`),t){t.title=n;let i=this.tabsEl?.querySelector(`[data-id="${this.activeTab}"] .title`);if(i)i.textContent=n||"\uD83D\uDC7B";document.title=n||"\uD83D\uDC7B";let s=document.getElementById("app-title");if(s)s.textContent=n||"\uD83D\uDC7B"}}}showCommandPalette(){this.commandPalette.show()}showUploadDialog(){this.uploadDialog.show()}showDownloadDialog(){this.downloadDialog.show()}showAccessControlDialog(){this.sendGetAuthState(),this.accessControlDialog.show()}setupShortcuts(){document.addEventListener("keydown",(t)=>{let e=document.getElementById("command-palette"),n=document.getElementById("download-dialog");if(e?.classList.contains("visible")||n?.classList.contains("visible"))return;if(t.metaKey&&t.key>="1"&&t.key<="9"){t.preventDefault(),t.stopPropagation();let i=parseInt(t.key)-1,s=Array.from(this.tabs.keys());if(i<s.length)this.switchToTab(s[i]);return}if(t.metaKey&&t.key==="/"){t.preventDefault(),t.stopPropagation(),this.createTab();return}if(t.metaKey&&!t.shiftKey&&t.key==="."){t.preventDefault(),t.stopPropagation(),this.closeActivePanel();return}if(t.metaKey&&t.shiftKey&&(t.key===">"||t.key===".")){t.preventDefault(),t.stopPropagation(),this.closeAllTabs();return}if(t.metaKey&&t.shiftKey&&(t.key==="a"||t.key==="A")){t.preventDefault(),t.stopPropagation(),this.showTabOverview();return}if(t.metaKey&&t.shiftKey&&(t.key==="p"||t.key==="P")){t.preventDefault(),t.stopPropagation(),this.showCommandPalette();return}if(t.metaKey&&!t.shiftKey&&(t.key==="u"||t.key==="U")){t.preventDefault(),t.stopPropagation(),this.showUploadDialog();return}if(t.metaKey&&t.shiftKey&&(t.key==="s"||t.key==="S")){t.preventDefault(),t.stopPropagation(),this.showDownloadDialog();return}if(t.metaKey&&!t.shiftKey&&(t.key==="d"||t.key==="D")){t.preventDefault(),t.stopPropagation(),this.splitActivePanel("right");return}if(t.metaKey&&t.shiftKey&&(t.key==="d"||t.key==="D")){t.preventDefault(),t.stopPropagation(),this.splitActivePanel("down");return}})}setupMenus(){document.querySelectorAll(".menu-item").forEach((t)=>{t.addEventListener("click",()=>{let e=t.dataset.action;if(!e)return;switch(e){case"new-tab":this.createTab();break;case"close-tab":this.closeActivePanel();break;case"close-all-tabs":this.closeAllTabs();break;case"upload":this.showUploadDialog();break;case"download":this.showDownloadDialog();break;case"sessions":case"access-control":this.showAccessControlDialog();break;case"split-right":this.splitActivePanel("right");break;case"split-down":this.splitActivePanel("down");break;case"split-left":this.splitActivePanel("left");break;case"split-up":this.splitActivePanel("up");break}})})}}var g;function z(){g=new B,g.init().catch(console.error),window.termwebApp=g}if(document.readyState==="loading")document.addEventListener("DOMContentLoaded",z);else z();export{ft as writeU32LE,ht as writeU16LE,lt as throttle,Q as shadowColor,D as rgbToHex,dt as readU32LE,at as readU16LE,ct as parseQueryParams,M as luminance,it as isVeryDark,K as isLightColor,st as highlightColor,F as hexToRgb,w as generateId,U as formatBytes,ot as debounce,ut as createBinaryMessage,rt as blendWithBlack,N as applyColors,W as TransferMsgType,k as SplitContainer,G as Role,E as Panel,T as KEY_MAP,$ as FrameType,L as FileTransferHandler,Z as FileResponseType,S as ClientMsg,X as BinaryCtrlMsg,J as AuthResponseType};
